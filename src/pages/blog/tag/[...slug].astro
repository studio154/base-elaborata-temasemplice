---
import BaseLayout from "@/layouts/BaseLayout.astro";
import BlogPost from "@/components/blog/BlogPost.astro";
import { getItemsFromCollection } from "@/utils/collections";

export async function getStaticPaths() {
  const allPosts = await getItemsFromCollection("posts");
  const uniqueTags = [...new Set(allPosts.map((post) => post.tags).flat())];

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) => post.tags.includes(tag));

    return {
      params: { slug: tag },
      props: { posts: filteredPosts, groupBy: { name: tag } },
    };
  });
}

const { posts, groupBy } = Astro.props;

const meta = {
  title: groupBy.name,
};
---

<BaseLayout meta={meta}>
  <section>
    <div class="px-8 py-12 mx-auto md:px-12 lg:px-32 max-w-7xl lg:py-24">
      <div class="max-w-2xl">
        <span class="text-xs font-bold tracking-wide uppercase text-accent-500">
          Tags</span
        ><p class="mt-8 text-4xl font-semibold tracking-tight text-accent-900">
          Posts tagged with {groupBy.name}
        </p>
      </div>

      <div class="mt-12 border-gray-300 divide-y divide-gray-300 border-y">
        {posts.map((post) => <BlogPost post={post} />)}
      </div>
    </div>
  </section>
</BaseLayout>
